# v2dmim-handle
消息处理rpc，作为消费者从MQ中消费（读取）消息，递增接收者收件箱seq，关联seq和msg，并存储到mongodb。全量历史消息无收件箱概念，消息作为流水记录落地mysql即可，两者通过协程独立处理，双方互不影响。msg作为无状态服务节点，如果消息量增加，可以启动冗余节点服务，加快消息处理流程。

（1）负责消费MQ中的消息，作为消费者，实时感知新信息达到，并触发回调逻辑；

（2）生成msgId作为全局消息Id；

（3）读取receiver userId，并通过redis的incr操作递增服务端对应的seq；

（4）关联seq和msgid，并存入以receiver userid为key的mongodb中，作为离线消息，一般在14天后会删除；

（5）同时，把消息作为历史记录存入mysql中，作为消息备份，或其他用途。

（4）和（5）是两个独立的协程并行执行的，mysql写入快慢不会影响mongodb的写入，这样既完成了冷热数据分离，也充分利用了机器资源。
